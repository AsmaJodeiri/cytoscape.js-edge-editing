!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cytoscapeEdgeEditing=t():e.cytoscapeEdgeEditing=t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){var n={currentCtxEdge:void 0,currentCtxPos:void 0,currentAnchorIndex:void 0,ignoredClasses:void 0,setIgnoredClasses:function(e){this.ignoredClasses=e},syntax:{bend:{edge:"segments",class:"edgebendediting-hasbendpoints",multiClass:"edgebendediting-hasmultiplebendpoints",weight:"cyedgebendeditingWeights",distance:"cyedgebendeditingDistances",weightCss:"segment-weights",distanceCss:"segment-distances",pointPos:"bendPointPositions"},control:{edge:"unbundled-bezier",class:"edgecontrolediting-hascontrolpoints",multiClass:"edgecontrolediting-hasmultiplecontrolpoints",weight:"cyedgecontroleditingWeights",distance:"cyedgecontroleditingDistances",weightCss:"control-point-weights",distanceCss:"control-point-distances",pointPos:"controlPointPositions"}},getEdgeType:function(e){return e?e.hasClass(this.syntax.bend.class)?"bend":e.hasClass(this.syntax.control.class)?"control":e.css("curve-style")===this.syntax.bend.edge?"bend":e.css("curve-style")===this.syntax.control.edge?"control":e.data(this.syntax.bend.pointPos)&&e.data(this.syntax.bend.pointPos).length>0?"bend":e.data(this.syntax.control.pointPos)&&e.data(this.syntax.control.pointPos).length>0?"control":"inconclusive":"inconclusive"},initAnchorPoints:function(e,t,n){for(var i=0;i<n.length;i++){var o=n[i],s=this.getEdgeType(o);if("inconclusive"!==s&&!this.isIgnoredEdge(o)){var d;"bend"===s?d=e.apply(this,o):"control"===s&&(d=t.apply(this,o));var a=this.convertToRelativePositions(o,d);a.distances.length>0&&(o.data(this.syntax[s].weight,a.weights),o.data(this.syntax[s].distance,a.distances),o.addClass(this.syntax[s].class),a.distances.length>1&&o.addClass(this.syntax[s].multiClass))}}},isIgnoredEdge:function(e){var t=e.source().position("x"),n=e.source().position("y"),i=e.target().position("x"),o=e.target().position("y");if(t==i&&n==o||e.source().id()==e.target().id())return!0;for(var s=0;this.ignoredClasses&&s<this.ignoredClasses.length;s++)if(e.hasClass(this.ignoredClasses[s]))return!0;return!1},getLineDirection:function(e,t){return e.y==t.y&&e.x<t.x?1:e.y<t.y&&e.x<t.x?2:e.y<t.y&&e.x==t.x?3:e.y<t.y&&e.x>t.x?4:e.y==t.y&&e.x>t.x?5:e.y>t.y&&e.x>t.x?6:e.y>t.y&&e.x==t.x?7:8},getSrcTgtPointsAndTangents:function(e){var t=e.source(),n=e.target(),i=(n.position(),t.position(),t.position()),o=n.position(),s=(o.y-i.y)/(o.x-i.x);return{m1:s,m2:-1/s,srcPoint:i,tgtPoint:o}},getIntersection:function(e,t,n){void 0===n&&(n=this.getSrcTgtPointsAndTangents(e));var i,o,s=n.srcPoint,d=(n.tgtPoint,n.m1),a=n.m2;if(d==1/0||d==-1/0)i=s.x,o=t.y;else if(0==d)i=t.x,o=s.y;else{var c=s.y-d*s.x;o=d*(i=(t.y-a*t.x-c)/(d-a))+c}return{x:i,y:o}},getAnchorsAsArray:function(e){var t=this.getEdgeType(e);if("inconclusive"!==t&&e.css("curve-style")===this.syntax[t].edge){for(var n=[],i=e.pstyle(this.syntax[t].weightCss)?e.pstyle(this.syntax[t].weightCss).pfValue:[],o=e.pstyle(this.syntax[t].distanceCss)?e.pstyle(this.syntax[t].distanceCss).pfValue:[],s=Math.min(i.length,o.length),d=e.source().position(),a=e.target().position(),c=a.y-d.y,r=a.x-d.x,l=Math.sqrt(r*r+c*c),g={x:r/l,y:c/l},u=-g.y,h=g.x,y=0;y<s;y++){var v=i[y],f=o[y],p=1-v,x=v,m={x1:d.x,x2:a.x,y1:d.y,y2:a.y},b={x:m.x1*p+m.x2*x,y:m.y1*p+m.y2*x};n.push(b.x+u*f,b.y+h*f)}return n}},convertToRelativePosition:function(e,t,n){void 0===n&&(n=this.getSrcTgtPointsAndTangents(e));var i,o=this.getIntersection(e,t,n),s=o.x,d=o.y,a=n.srcPoint,c=n.tgtPoint;i=s!=a.x?(s-a.x)/(c.x-a.x):d!=a.y?(d-a.y)/(c.y-a.y):0;var r=Math.sqrt(Math.pow(d-t.y,2)+Math.pow(s-t.x,2)),l=this.getLineDirection(a,c),g=this.getLineDirection(o,t);return l-g!=-2&&l-g!=6&&0!=r&&(r*=-1),{weight:i,distance:r}},convertToRelativePositions:function(e,t){for(var n=this.getSrcTgtPointsAndTangents(e),i=[],o=[],s=0;t&&s<t.length;s++){var d=t[s],a=this.convertToRelativePosition(e,d,n);i.push(a.weight),o.push(a.distance)}return{weights:i,distances:o}},getDistancesString:function(e,t){for(var n="",i=e.data(this.syntax[t].distance),o=0;i&&o<i.length;o++)n=n+" "+i[o];return n},getWeightsString:function(e,t){for(var n="",i=e.data(this.syntax[t].weight),o=0;i&&o<i.length;o++)n=n+" "+i[o];return n},addAnchorPoint:function(e,t,n){void 0!==e&&void 0!==t||(e=this.currentCtxEdge,t=this.currentCtxPos),void 0===n&&(n=this.getEdgeType(e));for(var i,o=this.syntax[n].weight,s=this.syntax[n].distance,d=this.convertToRelativePosition(e,t),a=d.weight,c=e.source().position("x"),r=e.source().position("y"),l=e.target().position("x"),g=e.target().position("y"),u=this.convertToRelativePosition(e,{x:c,y:r}).weight,h=this.convertToRelativePosition(e,{x:l,y:g}).weight,y=[u].concat(e.data(o)?e.data(o):[]).concat([h]),v=this.getAnchorsAsArray(e),f=1/0,p=[c,r].concat(v||[]).concat([l,g]),x=-1,m=0;m<y.length-1;m++){var b=y[m],A=y[m+1];const n=this.compareWithPrecision(a,b,!0),o=this.compareWithPrecision(a,A),s=this.compareWithPrecision(a,A,!0),d=this.compareWithPrecision(a,b);if(n&&o||s&&d){c=p[2*m],r=p[2*m+1],l=p[2*m+2];var w=(r-(g=p[2*m+3]))/(c-l),P={srcPoint:{x:c,y:r},tgtPoint:{x:l,y:g},m1:w,m2:-1/w},E=this.getIntersection(e,t,P),C=Math.sqrt(Math.pow(t.x-E.x,2)+Math.pow(t.y-E.y,2));C<f&&(f=C,i=E,x=m)}}void 0!==i&&(t=i),d=this.convertToRelativePosition(e,t),void 0===i&&(d.distance=0);var T=e.data(o),M=e.data(s);return M=M||[],0===(T=T||[]).length&&(x=0),-1!=x&&(T.splice(x,0,d.weight),M.splice(x,0,d.distance)),e.data(o,T),e.data(s,M),e.addClass(this.syntax[n].class),(T.length>1||M.length>1)&&e.addClass(this.syntax[n].multiClass),x},removeAnchor:function(e,t){void 0!==e&&void 0!==t||(e=this.currentCtxEdge,t=this.currentAnchorIndex);var n=this.getEdgeType(e);if(!this.edgeTypeInconclusiveShouldntHappen(n,"anchorPointUtilities.js, removeAnchor")){var i=this.syntax[n].weight,o=this.syntax[n].distance,s=this.syntax[n].pointPos,d=e.data(i),a=e.data(o),c=e.data(s);d.splice(t,1),a.splice(t,1),c&&c.splice(t,1),1==d.length||1==a.length?e.removeClass(this.syntax[n].multiClass):0==d.length||0==a.length?(e.removeClass(this.syntax[n].class),e.data(i,[]),e.data(o,[])):(e.data(i,d),e.data(o,a))}},removeAllAnchors:function(e){void 0===e&&(e=this.currentCtxEdge);var t=this.getEdgeType(e);if(!this.edgeTypeInconclusiveShouldntHappen(t,"anchorPointUtilities.js, removeAllAnchors")){e.removeClass(this.syntax[t].class),e.removeClass(this.syntax[t].multiClass);var n=this.syntax[t].weight,i=this.syntax[t].distance,o=this.syntax[t].pointPos;e.data(n,[]),e.data(i,[]),e.data(o)&&e.data(o,[])}},calculateDistance:function(e,t){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(Math.pow(n,2)+Math.pow(i,2))},compareWithPrecision:function(e,t,n=!1,i=.01){const o=e-t;return Math.abs(o)<=i||(n?e<t:e>t)},edgeTypeInconclusiveShouldntHappen:function(e,t){return"inconclusive"===e&&(console.log(`In ${t}: edge type inconclusive should never happen here!!`),!0)}};e.exports=n},function(e,t){var n,i,o=(n=Math.max,i=Date.now||function(){return(new Date).getTime()},function(e,t,o){var s,d,a,c,r,l,g,u,h,y=0,v=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");if(t=t<0?0:+t||0,!0===o){var p=!0;f=!1}else h=typeof(u=o),!u||"object"!=h&&"function"!=h||(p=!!o.leading,v="maxWait"in o&&n(+o.maxWait||0,t),f="trailing"in o?!!o.trailing:f);function x(t,n){n&&clearTimeout(n),d=l=g=void 0,t&&(y=i(),a=e.apply(r,s),l||d||(s=r=void 0))}function m(){var e=t-(i()-c);e<=0||e>t?x(g,d):l=setTimeout(m,e)}function b(){x(f,l)}function A(){if(s=arguments,c=i(),r=this,g=f&&(l||!p),!1===v)var n=p&&!l;else{d||p||(y=c);var o=v-(c-y),u=o<=0||o>v;u?(d&&(d=clearTimeout(d)),y=c,a=e.apply(r,s)):d||(d=setTimeout(b,o))}return u&&l?l=clearTimeout(l):l||t===v||(l=setTimeout(m,t)),n&&(u=!0,a=e.apply(r,s)),!u||l||d||(s=r=void 0),a}return A.cancel=function(){l&&clearTimeout(l),d&&clearTimeout(d),y=0,d=l=g=void 0},A});e.exports=o},function(e,t,n){var i;!function(){"use strict";var o=n(0),s=(n(1),function(e,t,i){var s=n(3);if(e&&t&&i){var d,a={bendPositionsFunction:function(e){return e.data("bendPointPositions")},controlPositionsFunction:function(e){return e.data("controlPointPositions")},initAnchorsAutomatically:!0,ignoredClasses:[],undoable:!1,anchorShapeSizeFactor:3,zIndex:999,enabled:!0,bendRemovalSensitivity:8,addBendMenuItemTitle:"Add Bend Point",removeBendMenuItemTitle:"Remove Bend Point",removeAllBendMenuItemTitle:"Remove All Bend Points",addControlMenuItemTitle:"Add Control Point",removeControlMenuItemTitle:"Remove Control Point",removeAllControlMenuItemTitle:"Remove All Control Points",moveSelectedAnchorsOnKeyEvents:function(){return!0},enableMultipleAnchorRemovalOption:!1},c=!1;e("core","edgeEditing",(function(e){var t=this;return"initialized"===e?c:("get"!==e&&(d=function(e,t){var n={};for(var i in e)n[i]=e[i];for(var i in t)if("bendRemovalSensitivity"==i){var o=t[i];isNaN(o)||(n[i]=o>=0&&o<=20?t[i]:o<0?0:20)}else n[i]=t[i];return n}(a,e),c=!0,t.style().selector(".edgebendediting-hasbendpoints").css({"curve-style":"segments","segment-distances":function(e){return o.getDistancesString(e,"bend")},"segment-weights":function(e){return o.getWeightsString(e,"bend")},"edge-distances":"node-position"}),t.style().selector(".edgecontrolediting-hascontrolpoints").css({"curve-style":"unbundled-bezier","control-point-distances":function(e){return o.getDistancesString(e,"control")},"control-point-weights":function(e){return o.getWeightsString(e,"control")},"edge-distances":"node-position"}),o.setIgnoredClasses(d.ignoredClasses),d.initAnchorsAutomatically&&o.initAnchorPoints(d.bendPositionsFunction,d.controlPositionsFunction,t.edges(),d.ignoredClasses),d.enabled?s(d,t):s("unbind",t)),c?{getAnchorsAsArray:function(e){return o.getAnchorsAsArray(e)},initAnchorPoints:function(e){o.initAnchorPoints(d.bendPositionsFunction,d.controlPositionsFunction,e)},deleteSelectedAnchor:function(e,t){o.removeAnchor(e,t)}}:void 0)}))}});e.exports&&(e.exports=s),void 0===(i=function(){return s}.call(t,n,t,e))||(e.exports=i),"undefined"!=typeof cytoscape&&$&&Konva&&s(cytoscape,$,Konva)}()},function(e,t,n){var o=n(1),s=n(0),d=n(4),a=n(5),c=0;e.exports=function(e,t){var n,r,l,g,u,h,y,v,f,p,x,m,b,A,w,P,E,C,T=e,M="cy-edge-bend-editing-cxt-add-bend-point"+c,I="cy-edge-bend-editing-cxt-remove-bend-point"+c,S="cy-edge-bend-editing-cxt-remove-multiple-bend-point"+c,R="cy-edge-control-editing-cxt-add-control-point"+c,D="cy-edge-control-editing-cxt-remove-control-point"+c,F="cy-edge-bend-editing-cxt-remove-multiple-control-point"+c,B=null,O=null,K=!1,W={init:function(){a(t,s,e);var T=e,W=$(this),k="cy-node-edge-editing-stage"+c;c++;var z,j,L=$('<div id="'+k+'"></div>');W.find("#"+k).length<1&&W.append(L),(z=Konva.stages.length<c?new Konva.Stage({id:"node-edge-editing-stage",container:k,width:W.width(),height:W.height()}):Konva.stages[c-1]).getChildren().length<1?(j=new Konva.Layer,z.add(j)):j=z.getChildren()[0];var U={edge:void 0,edgeType:"inconclusive",anchors:[],touchedAnchor:void 0,touchedAnchorIndex:void 0,bindListeners:function(e){e.on("mousedown touchstart",this.eMouseDown)},unbindListeners:function(e){e.off("mousedown touchstart",this.eMouseDown)},eMouseDown:function(e){t.autounselectify(!1),K=!0,U.touchedAnchor=e.target,C=!1,U.edge.unselect();var n=s.syntax[U.edgeType].weight,i=s.syntax[U.edgeType].distance,o=U.edge;he={edge:o,type:U.edgeType,weights:o.data(n)?[].concat(o.data(n)):[],distances:o.data(i)?[].concat(o.data(i)):[]},function(){P=t.style()._private.coreStyle["active-bg-opacity"]?t.style()._private.coreStyle["active-bg-opacity"].value:.15;t.style().selector("core").style("active-bg-opacity",0).update()}(),ae(),t.autoungrabify(!0),j.getStage().on("contentTouchend contentMouseup",U.eMouseUp),j.getStage().on("contentMouseout",U.eMouseOut)},eMouseUp:function(e){K=!1,U.touchedAnchor=void 0,C=!1,U.edge.select(),t.style().selector("core").style("active-bg-opacity",P).update(),ce(),t.autounselectify(!0),t.autoungrabify(!1),j.getStage().off("contentTouchend contentMouseup",U.eMouseUp),j.getStage().off("contentMouseout",U.eMouseOut)},eMouseOut:function(e){C=!0},clearAnchorsExcept:function(e){var t=!1;this.anchors.forEach((n,i)=>{e&&n===e?t=!0:(this.unbindListeners(n),n.destroy())}),t?this.anchors=[e]:(this.anchors=[],this.edge=void 0,this.edgeType="inconclusive")},renderAnchorShapes:function(e){if(this.edge=e,this.edgeType=s.getEdgeType(e),e.hasClass("edgebendediting-hasbendpoints")||e.hasClass("edgecontrolediting-hascontrolpoints")){for(var t=s.getAnchorsAsArray(e),n=.65*oe(e),i=(e.source().position(),e.target().position(),0);t&&i<t.length;i+=2){var o=t[i],d=t[i+1];this.renderAnchorShape(o,d,n)}j.draw()}},renderAnchorShape:function(e,n,i){var o=ne({x:e-i/2,y:n-i/2});i*=t.zoom();var s=new Konva.Rect({x:o.x,y:o.y,width:i,height:i,fill:"black",strokeWidth:0,draggable:!0});this.anchors.push(s),this.bindListeners(s),j.add(s)}},_=function(e,n){var i=e.target||e.cyTarget;if(!s.isIgnoredEdge(i)){var o,d,a,c,r=s.getEdgeType(i);"inconclusive"===r?(o=[],d=[]):(a=s.syntax[r].weight,c=s.syntax[r].distance,o=i.data(a)?[].concat(i.data(a)):i.data(a),d=i.data(c)?[].concat(i.data(c)):i.data(c));var l={edge:i,type:r,weights:o,distances:d};s.addAnchorPoint(void 0,void 0,n),te().undoable&&t.undoRedo().do("changeAnchorPoints",l)}ie(),i.select()},N=function(e){var n=U.edge,i=s.getEdgeType(n);if(!s.edgeTypeInconclusiveShouldntHappen(i,"UiUtilities.js, cxtRemoveAnchorFcn")){var o={edge:n,type:i,weights:[].concat(n.data(s.syntax[i].weight)),distances:[].concat(n.data(s.syntax[i].distance))};s.removeAnchor(),te().undoable&&t.undoRedo().do("changeAnchorPoints",o),setTimeout((function(){ie(),n.select()}),50)}},q=function(e){var n=U.edge,i=s.getEdgeType(n),o={edge:n,type:i,weights:[].concat(n.data(s.syntax[i].weight)),distances:[].concat(n.data(s.syntax[i].distance))};s.removeAllAnchors(),te().undoable&&t.undoRedo().do("changeAnchorPoints",o),setTimeout((function(){ie(),n.select()}),50)},H=T.handleReconnectEdge,V=T.validateEdge,X=T.actOnUnsuccessfulReconnection,G=[{id:M,content:T.addBendMenuItemTitle,selector:"edge",onClickFunction:function(e){_(e,"bend")}},{id:I,content:T.removeBendMenuItemTitle,selector:"edge",onClickFunction:N},{id:S,content:T.removeAllBendMenuItemTitle,selector:T.enableMultipleAnchorRemovalOption&&":selected.edgebendediting-hasmultiplebendpoints",onClickFunction:q},{id:R,content:T.addControlMenuItemTitle,selector:"edge",coreAsWell:!0,onClickFunction:function(e){_(e,"control")}},{id:D,content:T.removeControlMenuItemTitle,selector:"edge",coreAsWell:!0,onClickFunction:N},{id:F,content:T.removeAllControlMenuItemTitle,selector:T.enableMultipleAnchorRemovalOption&&":selected.edgecontrolediting-hasmultiplecontrolpoints",onClickFunction:q}];if(t.contextMenus){var J=t.contextMenus("get");J.isActive()?J.appendMenuItems(G):t.contextMenus({menuItems:G})}var Q=o((function(){L.attr("height",W.height()).attr("width",W.width()).css({position:"absolute",top:0,left:0,"z-index":te().zIndex}),setTimeout((function(){var e=L.offset(),n=W.offset();L.css({top:-(e.top-n.top),left:-(e.left-n.left)}),j.getStage().setWidth(W.width()),j.getStage().setHeight(W.height()),t&&ie()}),0)}),250);function Y(){Q()}Y(),$(window).bind("resize",(function(){Y()}));var Z,ee=W.data("cyedgeediting");function te(){return Z||(Z=W.data("cyedgeediting").options)}function ne(e){var n=t.pan(),i=t.zoom();return{x:e.x*i+n.x,y:e.y*i+n.y}}function ie(){U.clearAnchorsExcept(U.touchedAnchor),null!==B&&(B.destroy(),B=null),null!==O&&(O.destroy(),O=null),j.draw(),E&&(U.renderAnchorShapes(E),function(e){if(!e)return;var n=s.getAnchorsAsArray(e);void 0===n&&(n=[]);var i=e.sourceEndpoint(),o=e.targetEndpoint();if(n.unshift(i.y),n.unshift(i.x),n.push(o.x),n.push(o.y),!n)return;var d={x:n[0],y:n[1]},a={x:n[n.length-2],y:n[n.length-1]},c={x:n[2],y:n[3]},r={x:n[n.length-4],y:n[n.length-3]},l=.65*oe(e);!function(e,n,i,o,s){var d=e.x-i/2,a=e.y-i/2,c=n.x-i/2,r=n.y-i/2,l=o.x-i/2,g=o.y-i/2,u=s.x-i/2,h=s.y-i/2,y=ne({x:d,y:a}),v=ne({x:c,y:r});i=i*t.zoom()/2;var f=ne({x:l,y:g}),p=ne({x:u,y:h}),x=i,m=Math.sqrt(Math.pow(f.x-y.x,2)+Math.pow(f.y-y.y,2)),b=y.x+x/m*(f.x-y.x),A=y.y+x/m*(f.y-y.y),w=Math.sqrt(Math.pow(p.x-v.x,2)+Math.pow(p.y-v.y,2)),P=v.x+x/w*(p.x-v.x),E=v.y+x/w*(p.y-v.y);B=new Konva.Circle({x:b+i,y:A+i,radius:i,fill:"black"}),O=new Konva.Circle({x:P+i,y:E+i,radius:i,fill:"black"}),j.add(B),j.add(O),j.draw()}(d,a,l,c,r)}(E))}function oe(e){var t=te().anchorShapeSizeFactor;return parseFloat(e.css("width"))<=2.5?2.5*t:parseFloat(e.css("width"))*t}function se(e,t,n,i,o){return e>=i-n/2&&e<=i+n/2&&t>=o-n/2&&t<=o+n/2}function de(e,t,n){var i=s.getEdgeType(n);if("inconclusive"===i)return-1;if(null==n.data(s.syntax[i].weight)||0==n.data(s.syntax[i].weight).length)return-1;for(var o=s.getAnchorsAsArray(n),d=oe(n),a=0;o&&a<o.length;a+=2){if(se(e,t,d,o[a],o[a+1]))return a/2}return-1}function ae(){b=t.panningEnabled(),A=t.zoomingEnabled(),w=t.boxSelectionEnabled(),t.zoomingEnabled(!1).panningEnabled(!1).boxSelectionEnabled(!1)}function ce(){t.zoomingEnabled(A).panningEnabled(b).boxSelectionEnabled(w)}null==ee&&(ee={}),ee.options=T;var re=o((function(e,t,n,i){var o=e.data(s.syntax[t].weight),d=e.data(s.syntax[t].distance),a=s.convertToRelativePosition(e,i);o[n]=a.weight,d[n]=a.distance,e.data(s.syntax[t].weight,o),e.data(s.syntax[t].distance,d)}),5);b=t.panningEnabled(),A=t.zoomingEnabled(),w=t.boxSelectionEnabled();var le,ge,ue,he,ye,ve,fe,pe,xe,me=(Ee=t.edges(":selected")).length;1===me&&(E=Ee[0]),t.bind("zoom pan",g=function(){E&&ie()}),t.on("data","edge",(function(){E&&ie()})),t.on("style","edge.edgebendediting-hasbendpoints:selected, edge.edgecontrolediting-hascontrolpoints:selected",n=function(){ie()}),t.on("remove","edge",r=function(){if(this.selected()){if(me-=1,t.startBatch(),E&&E.removeClass("cy-edge-editing-highlight"),1===me){var e=t.edges(":selected");1===e.length?(E=e[0]).addClass("cy-edge-editing-highlight"):E=void 0}else E=void 0;t.endBatch()}ie()}),t.on("add","edge",l=function(){this.selected()&&(me+=1,t.startBatch(),E&&E.removeClass("cy-edge-editing-highlight"),1===me?(E=this).addClass("cy-edge-editing-highlight"):E=void 0,t.endBatch()),ie()}),t.on("select","edge",u=function(){0!=this.target().connectedEdges().length&&0!=this.source().connectedEdges().length&&(me+=1,t.startBatch(),E&&E.removeClass("cy-edge-editing-highlight"),1===me?(E=this).addClass("cy-edge-editing-highlight"):E=void 0,t.endBatch(),ie())}),t.on("unselect","edge",h=function(){if(me-=1,t.startBatch(),E&&E.removeClass("cy-edge-editing-highlight"),1===me){var e=t.edges(":selected");1===e.length?(E=e[0]).addClass("cy-edge-editing-highlight"):E=void 0}else E=void 0;t.endBatch(),ie()});var be,Ae,we,Pe,Ee,Ce=!1;t.on("tapstart",y=function(e){ge=e.position||e.cyPosition}),t.on("tapstart","edge",v=function(e){if(E&&E.id()===this.id()){ue=this;var n=s.getEdgeType(this);"inconclusive"===n&&(n="bend");var i=function(e,t,n){var i=oe(n),o=n._private.rscratch.allpts,s={x:o[0],y:o[1]},d={x:o[o.length-2],y:o[o.length-1]};return ne(s),ne(d),se(e,t,i,s.x,s.y)?0:se(e,t,i,d.x,d.y)?1:-1}(ge.x,ge.y,this);if(0==i||1==i){this.unselect(),ve=i,pe=0==i?ue.source():ue.target();var o=0==i?"source":"target",a=d.disconnectEdge(ue,t,e.renderedPosition,o);fe=a.dummyNode,ue=a.edge,ae()}else le=void 0,ye=!0}else ye=!1}),t.on("drag","node",m=function(e){t.edges().unselect(),this.selected()||t.nodes().unselect()}),t.on("tapdrag",f=function(e){t.edges(":selected").length>0&&t.autounselectify(!1);var n=ue;if(void 0===ue||!s.isIgnoredEdge(n)){var i=s.getEdgeType(n);if(ye&&!K&&"inconclusive"!==i){var o=s.syntax[i].weight,d=s.syntax[i].distance;he={edge:n,type:i,weights:n.data(o)?[].concat(n.data(o)):[],distances:n.data(d)?[].concat(n.data(d)):[]},n.unselect(),le=s.addAnchorPoint(n,ge),ue=n,ye=void 0,Ce=!0,ae()}if(K||void 0!==ue&&(void 0!==le||void 0!==ve)){var a=e.position||e.cyPosition;-1!=ve&&fe?fe.position(a):null!=le?re(n,i,le,a):K&&(void 0===U.touchedAnchorIndex&&ge&&(U.touchedAnchorIndex=de(ge.x,ge.y,U.edge)),void 0!==U.touchedAnchorIndex&&re(U.edge,U.edgeType,U.touchedAnchorIndex,a)),e.target&&e.target[0]&&e.target.isNode()&&(xe=e.target)}}}),t.on("tapend",p=function(e){C&&j.getStage().fire("contentMouseup");var n=ue||U.edge;if(void 0!==n){var i=U.touchedAnchorIndex;if(null!=i){var o,a=n.source().position("x"),c=n.source().position("y"),r=n.target().position("x"),l=n.target().position("y"),g=s.getAnchorsAsArray(n),u=[a,c].concat(g).concat([r,l]),h=i+1,y=h-1,v=h+1,f={x:u[2*h],y:u[2*h+1]},p={x:u[2*y],y:u[2*y+1]},x={x:u[2*v],y:u[2*v+1]};if(f.x===p.x&&f.y===p.y||f.x===p.x&&f.y===p.y)o=!0;else{var m,b=(p.y-x.y)/(p.x-x.x),A={srcPoint:p,tgtPoint:x,m1:b,m2:-1/b},w=s.getIntersection(n,f,A),P=Math.sqrt(Math.pow(f.x-w.x,2)+Math.pow(f.y-w.y,2));"bend"===(m=s.getEdgeType(n))&&P<te().bendRemovalSensitivity&&(o=!0)}o&&s.removeAnchor(n,i)}else if(null!=fe&&(0==ve||1==ve)){var E=pe,T="valid",M=0==ve?"source":"target";if(xe){var I=0==ve?xe:n.source(),S=1==ve?xe:n.target();"function"==typeof V&&(T=V(n,I,S)),E="valid"===T?xe:pe}I=0==ve?E:n.source(),S=1==ve?E:n.target();if(n=d.connectEdge(n,pe,M),pe.id()!==E.id())if("function"==typeof H){var R=H(I.id(),S.id(),n.data());if(R&&(d.copyEdge(n,R),s.initAnchorPoints(te().bendPositionsFunction,te().controlPositionsFunction,[R])),R&&te().undoable){var D={newEdge:R,oldEdge:n};t.undoRedo().do("removeReconnectedEdge",D),n=R}else R&&(t.remove(n),n=R)}else{var F=0==ve?{source:E.id()}:{target:E.id()},B=0==ve?{source:pe.id()}:{target:pe.id()};if(te().undoable&&E.id()!==pe.id()){var O={edge:n,location:F,oldLoc:B};n=t.undoRedo().do("reconnectEdge",O).edge}}"valid"!==T&&"function"==typeof X&&X(),n.select(),t.remove(fe)}}"inconclusive"===(m=s.getEdgeType(n))&&(m="bend"),void 0!==U.touchedAnchorIndex||Ce||(he=void 0);var K=s.syntax[m].weight;void 0!==n&&void 0!==he&&(n.data(K)?n.data(K).toString():null)!=he.weights.toString()&&(Ce&&(n.select(),t.autounselectify(!0)),te().undoable&&t.undoRedo().do("changeAnchorPoints",he)),le=void 0,ue=void 0,he=void 0,ye=void 0,ve=void 0,fe=void 0,pe=void 0,xe=void 0,ge=void 0,Ce=!1,U.touchedAnchorIndex=void 0,ce(),setTimeout((function(){ie()}),50)}),t.on("edgeediting.movestart",(function(e,t){Pe=!1,null!=t[0]&&t.forEach((function(e){null==s.getAnchorsAsArray(e)||Pe||(Ae={x:s.getAnchorsAsArray(e)[0],y:s.getAnchorsAsArray(e)[1]},be={firstTime:!0,firstAnchorPosition:{x:Ae.x,y:Ae.y},edges:t},we=e,Pe=!0)}))})),t.on("edgeediting.moveend",(function(e,n){if(null!=be){var i=be.firstAnchorPosition,o={x:s.getAnchorsAsArray(we)[0],y:s.getAnchorsAsArray(we)[1]};be.positionDiff={x:-o.x+i.x,y:-o.y+i.y},delete be.firstAnchorPosition,te().undoable&&t.undoRedo().do("moveAnchorPoints",be),be=void 0}})),t.on("cxttap",x=function(e){var n,i,o=e.target||e.cyTarget,d=!1;try{d=o.isEdge()}catch(e){}d?(n=o,i=s.getEdgeType(n)):(n=U.edge,i=U.edgeType);var a=t.contextMenus("get");if(!E||E.id()!=n.id()||s.isIgnoredEdge(n)||E!==n)return a.hideMenuItem(I),a.hideMenuItem(M),a.hideMenuItem(D),void a.hideMenuItem(R);var c=e.position||e.cyPosition,r=de(c.x,c.y,n);-1==r?(a.hideMenuItem(I),a.hideMenuItem(D),"control"===i&&d?(a.showMenuItem(R),a.hideMenuItem(M)):"bend"===i&&d?(a.showMenuItem(M),a.hideMenuItem(R)):d?(a.showMenuItem(M),a.showMenuItem(R)):(a.hideMenuItem(M),a.hideMenuItem(R)),s.currentCtxPos=c):(a.hideMenuItem(M),a.hideMenuItem(R),"control"===i?(a.showMenuItem(D),a.hideMenuItem(I),n.hasClass("edgecontrolediting-hasmultiplecontrolpoints")&&a.showMenuItem(F)):"bend"===i?(a.showMenuItem(I),a.hideMenuItem(D)):(a.hideMenuItem(I),a.hideMenuItem(D),a.hideMenuItem(F)),s.currentAnchorIndex=r),s.currentCtxEdge=n}),t.on("cyedgeediting.changeAnchorPoints","edge",(function(){t.startBatch(),t.edges().unselect(),t.trigger("bendPointMovement"),t.endBatch(),ie()}));var Te=!1,Me={37:!1,38:!1,39:!1,40:!1};document.addEventListener("keydown",(function(e){if("function"==typeof te().moveSelectedAnchorsOnKeyEvents?te().moveSelectedAnchorsOnKeyEvents():te().moveSelectedAnchorsOnKeyEvents){var n,o,d=document.activeElement.tagName;if("TEXTAREA"!=d&&"INPUT"!=d){switch(e.keyCode){case 37:case 39:case 38:case 40:case 32:e.preventDefault()}if(e.keyCode<"37"||e.keyCode>"40")return;if(Me[e.keyCode]=!0,t.edges(":selected").length!=t.elements(":selected").length||1!=t.edges(":selected").length)return;Te||(Ee=t.edges(":selected"),t.trigger("edgeediting.movestart",[Ee]),Te=!0);var a=3;if(e.altKey&&e.shiftKey)return;e.altKey?a=1:e.shiftKey&&(a=10);var c=0,r=0;c+=Me[39]?a:0,c-=Me[37]?a:0,r+=Me[40]?a:0,r-=Me[38]?a:0,n={x:c,y:r},(o=Ee).forEach((function(e){var t=s.getAnchorsAsArray(e),o=[];if(null!=t){for(i=0;i<t.length;i+=2)o.push({x:t[i]+n.x,y:t[i+1]+n.y});var d=s.getEdgeType(e);if(s.edgeTypeInconclusiveShouldntHappen(d,"UiUtilities.js, moveAnchorPoints"))return;e.data(s.syntax[d].pointPos,o)}})),s.initAnchorPoints(te().bendPositionsFunction,te().controlPositionsFunction,o),t.trigger("bendPointMovement")}}}),!0),document.addEventListener("keyup",(function(e){e.keyCode<"37"||e.keyCode>"40"||(e.preventDefault(),Me[e.keyCode]=!1,("function"==typeof te().moveSelectedAnchorsOnKeyEvents?te().moveSelectedAnchorsOnKeyEvents():te().moveSelectedAnchorsOnKeyEvents)&&(t.trigger("edgeediting.moveend",[Ee]),Ee=void 0,Te=!1))}),!0),W.data("cyedgeediting",ee)},unbind:function(){t.off("remove","node",r).off("add","node",l).off("style","edge.edgebendediting-hasbendpoints:selected, edge.edgecontrolediting-hascontrolpoints:selected",n).off("select","edge",u).off("unselect","edge",h).off("tapstart",y).off("tapstart","edge",v).off("tapdrag",f).off("tapend",p).off("cxttap",x).off("drag","node",m),t.unbind("zoom pan",g)}};return W[T]?W[T].apply($(t.container()),Array.prototype.slice.call(arguments,1)):"object"!=typeof T&&T?($.error("No such function `"+T+"` for cytoscape.js-edge-editing"),$(this)):W.init.apply($(t.container()),arguments)}},function(e,t){e.exports={disconnectEdge:function(e,t,n,i){var o={data:{id:"nwt_reconnectEdge_dummy",ports:[]},style:{width:1,height:1,visibility:"hidden"},renderedPosition:n};t.add(o);var s="source"===i?{source:o.data.id}:{target:o.data.id};return e=e.move(s)[0],{dummyNode:t.nodes("#"+o.data.id)[0],edge:e}},connectEdge:function(e,t,n){if(e.isEdge()&&t.isNode()){var i={};if("source"===n)i.source=t.id();else{if("target"!==n)return;i.target=t.id()}return e.move(i)[0]}},copyEdge:function(e,t){this.copyAnchors(e,t),this.copyStyle(e,t)},copyStyle:function(e,t){e&&t&&(t.data("line-color",e.data("line-color")),t.data("width",e.data("width")),t.data("cardinality",e.data("cardinality")))},copyAnchors:function(e,t){if(e.hasClass("edgebendediting-hasbendpoints")){var n=e.data("cyedgebendeditingDistances"),i=e.data("cyedgebendeditingWeights");t.data("cyedgebendeditingDistances",n),t.data("cyedgebendeditingWeights",i),t.addClass("edgebendediting-hasbendpoints")}else if(e.hasClass("edgecontrolediting-hascontrolpoints")){n=e.data("cyedgecontroleditingDistances"),i=e.data("cyedgecontroleditingWeights");t.data("cyedgecontroleditingDistances",n),t.data("cyedgecontroleditingWeights",i),t.addClass("edgecontrolediting-hascontrolpoints")}e.hasClass("edgebendediting-hasmultiplebendpoints")?t.addClass("edgebendediting-hasmultiplebendpoints"):e.hasClass("edgecontrolediting-hasmultiplecontrolpoints")&&t.addClass("edgecontrolediting-hasmultiplecontrolpoints")}}},function(e,t){e.exports=function(e,t,n){if(null!=e.undoRedo){var o=e.undoRedo({defaultActions:!1,isDebug:!0});o.action("changeAnchorPoints",s,s),o.action("moveAnchorPoints",d,d),o.action("reconnectEdge",a,a),o.action("removeReconnectedEdge",c,c)}function s(n){var i,o,s,d,a=e.getElementById(n.edge.id()),c="inconclusive"!==n.type?n.type:t.getEdgeType(a);"inconclusive"!==n.type||n.set?(s=t.syntax[c].weight,d=t.syntax[c].distance,i=n.set?a.data(s):n.weights,o=n.set?a.data(d):n.distances):(i=[],o=[]);var r={edge:a,type:c,weights:i,distances:o,set:!0};if(n.set){var l=n.weights&&n.weights.length>0,g=l&&n.weights.length>1;l?a.data(s,n.weights):a.removeData(s),l?a.data(d,n.distances):a.removeData(d);var u=t.syntax[c].class,h=t.syntax[c].multiClass;l||g?l&&!g?(a.addClass(u),a.removeClass(h)):a.addClass(u+" "+h):a.removeClass(u+" "+h)}return a.trigger("cyedgeediting.changeAnchorPoints"),r}function d(e){if(e.firstTime)return delete e.firstTime,e;var o=e.edges,s=e.positionDiff,d={edges:o,positionDiff:{x:-s.x,y:-s.y}};return function(e,o){o.forEach((function(n){var o=t.getEdgeType(n),s=t.getAnchorsAsArray(n),d=[];if(null!=s){for(i=0;i<s.length;i+=2)d.push({x:s[i]+e.x,y:s[i+1]+e.y});n.data(t.syntax[o].pointPos,d)}})),t.initAnchorPoints(n.bendPositionsFunction,n.controlPositionsFunction,o)}(s,o),d}function a(e){var t=e.edge,n=e.location,i=e.oldLoc,o={edge:t=t.move(n)[0],location:i,oldLoc:n};return t.unselect(),o}function c(t){var n=t.oldEdge;(i=e.getElementById(n.data("id")))&&i.length>0&&(n=i);var i,o=t.newEdge;return(i=e.getElementById(o.data("id")))&&i.length>0&&(o=i),n.inside()&&(n=n.remove()[0]),o.removed()&&(o=o.restore()).unselect(),{oldEdge:o,newEdge:n}}}}])}));