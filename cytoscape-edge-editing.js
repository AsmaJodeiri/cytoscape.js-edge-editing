!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cytoscapeEdgeEditing=t():e.cytoscapeEdgeEditing=t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";var i={currentCtxEdge:void 0,currentCtxPos:void 0,currentAnchorIndex:void 0,ignoredClasses:void 0,setIgnoredClasses:function(e){this.ignoredClasses=e},syntax:{bend:{edge:"segments",class:"edgebendediting-hasbendpoints",multiClass:"edgebendediting-hasmultiplebendpoints",weight:"cyedgebendeditingWeights",distance:"cyedgebendeditingDistances",weightCss:"segment-weights",distanceCss:"segment-distances",pointPos:"bendPointPositions"},control:{edge:"unbundled-bezier",class:"edgecontrolediting-hascontrolpoints",multiClass:"edgecontrolediting-hasmultiplecontrolpoints",weight:"cyedgecontroleditingWeights",distance:"cyedgecontroleditingDistances",weightCss:"control-point-weights",distanceCss:"control-point-distances",pointPos:"controlPointPositions"}},getEdgeType:function(e){return e?e.hasClass(this.syntax.bend.class)?"bend":e.hasClass(this.syntax.control.class)?"control":e.css("curve-style")===this.syntax.bend.edge?"bend":e.css("curve-style")===this.syntax.control.edge?"control":e.data(this.syntax.bend.pointPos)&&e.data(this.syntax.bend.pointPos).length>0?"bend":e.data(this.syntax.control.pointPos)&&e.data(this.syntax.control.pointPos).length>0?"control":"inconclusive":"inconclusive"},initAnchorPoints:function(e,t,n){for(var i=0;i<n.length;i++){var o=n[i],s=this.getEdgeType(o);if("inconclusive"!==s&&!this.isIgnoredEdge(o)){var a;"bend"===s?a=e.apply(this,o):"control"===s&&(a=t.apply(this,o));var d={weights:[],distances:[]};if(a)d=this.convertToRelativePositions(o,a);else{var r=o.data(this.syntax[s].weight),c=o.data(this.syntax[s].distance);r&&c&&(d={weights:r,distances:c})}d.distances.length>0?(o.data(this.syntax[s].weight,d.weights),o.data(this.syntax[s].distance,d.distances),o.addClass(this.syntax[s].class),d.distances.length>1&&o.addClass(this.syntax[s].multiClass)):(o.data(this.syntax[s].weight,[]),o.data(this.syntax[s].distance,[]),o.hasClass(this.syntax[s].class)&&o.removeClass(this.syntax[s].class),o.hasClass(this.syntax[s].multiClass)&&o.removeClass(this.syntax[s].multiClass))}}},isIgnoredEdge:function(e){var t=e.source().position("x"),n=e.source().position("y"),i=e.target().position("x"),o=e.target().position("y");if(t==i&&n==o||e.source().id()==e.target().id())return!0;for(var s=0;this.ignoredClasses&&s<this.ignoredClasses.length;s++)if(e.hasClass(this.ignoredClasses[s]))return!0;return!1},getLineDirection:function(e,t){return e.y==t.y&&e.x<t.x?1:e.y<t.y&&e.x<t.x?2:e.y<t.y&&e.x==t.x?3:e.y<t.y&&e.x>t.x?4:e.y==t.y&&e.x>t.x?5:e.y>t.y&&e.x>t.x?6:e.y>t.y&&e.x==t.x?7:8},getSrcTgtPointsAndTangents:function(e){var t=e.source(),n=e.target(),i=(n.position(),t.position(),t.position()),o=n.position(),s=(o.y-i.y)/(o.x-i.x);return{m1:s,m2:-1/s,srcPoint:i,tgtPoint:o}},getIntersection:function(e,t,n){void 0===n&&(n=this.getSrcTgtPointsAndTangents(e));var i,o,s=n.srcPoint,a=(n.tgtPoint,n.m1),d=n.m2;if(a==1/0||a==-1/0)i=s.x,o=t.y;else if(0==a)i=t.x,o=s.y;else{var r=s.y-a*s.x;o=a*(i=(t.y-d*t.x-r)/(a-d))+r}return{x:i,y:o}},getAnchorsAsArray:function(e){var t=this.getEdgeType(e);if("inconclusive"!==t&&e.css("curve-style")===this.syntax[t].edge){for(var n=[],i=e.pstyle(this.syntax[t].weightCss)?e.pstyle(this.syntax[t].weightCss).pfValue:[],o=e.pstyle(this.syntax[t].distanceCss)?e.pstyle(this.syntax[t].distanceCss).pfValue:[],s=Math.min(i.length,o.length),a=e.source().position(),d=e.target().position(),r=d.y-a.y,c=d.x-a.x,l=Math.sqrt(c*c+r*r),g={x:c/l,y:r/l},u=-g.y,h=g.x,y=0;y<s;y++){var v=i[y],f=o[y],p=1-v,x=v,m={x1:a.x,x2:d.x,y1:a.y,y2:d.y},b={x:m.x1*p+m.x2*x,y:m.y1*p+m.y2*x};n.push(b.x+u*f,b.y+h*f)}return n}},convertToRelativePosition:function(e,t,n){void 0===n&&(n=this.getSrcTgtPointsAndTangents(e));var i,o=this.getIntersection(e,t,n),s=o.x,a=o.y,d=n.srcPoint,r=n.tgtPoint;i=s!=d.x?(s-d.x)/(r.x-d.x):a!=d.y?(a-d.y)/(r.y-d.y):0;var c=Math.sqrt(Math.pow(a-t.y,2)+Math.pow(s-t.x,2)),l=this.getLineDirection(d,r),g=this.getLineDirection(o,t);return l-g!=-2&&l-g!=6&&0!=c&&(c*=-1),{weight:i,distance:c}},convertToRelativePositions:function(e,t){for(var n=this.getSrcTgtPointsAndTangents(e),i=[],o=[],s=0;t&&s<t.length;s++){var a=t[s],d=this.convertToRelativePosition(e,a,n);i.push(d.weight),o.push(d.distance)}return{weights:i,distances:o}},getDistancesString:function(e,t){for(var n="",i=e.data(this.syntax[t].distance),o=0;i&&o<i.length;o++)n=n+" "+i[o];return n},getWeightsString:function(e,t){for(var n="",i=e.data(this.syntax[t].weight),o=0;i&&o<i.length;o++)n=n+" "+i[o];return n},addAnchorPoint:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;void 0!==e&&void 0!==t||(e=this.currentCtxEdge,t=this.currentCtxPos),void 0===n&&(n=this.getEdgeType(e));for(var i,o=this.syntax[n].weight,s=this.syntax[n].distance,a=this.convertToRelativePosition(e,t),d=a.weight,r=e.source().position("x"),c=e.source().position("y"),l=e.target().position("x"),g=e.target().position("y"),u=this.convertToRelativePosition(e,{x:r,y:c}).weight,h=this.convertToRelativePosition(e,{x:l,y:g}).weight,y=[u].concat(e.data(o)?e.data(o):[]).concat([h]),v=this.getAnchorsAsArray(e),f=1/0,p=[r,c].concat(v||[]).concat([l,g]),x=-1,m=0;m<y.length-1;m++){var b=y[m],A=y[m+1],w=this.compareWithPrecision(d,b,!0),C=this.compareWithPrecision(d,A),P=this.compareWithPrecision(d,A,!0),T=this.compareWithPrecision(d,b);if(w&&C||P&&T){var E={x:r=p[2*m],y:c=p[2*m+1]},M={x:l=p[2*m+2],y:g=p[2*m+3]},I=(c-g)/(r-l),S=-1/I,D={srcPoint:E,tgtPoint:M,m1:I,m2:S},R=this.getIntersection(e,t,D),O=Math.sqrt(Math.pow(t.x-R.x,2)+Math.pow(t.y-R.y,2));O<f&&(f=O,i=R,x=m)}}void 0!==i&&(t=i),a=this.convertToRelativePosition(e,t),void 0===i&&(a.distance=0);var F=e.data(o),B=e.data(s);return B=B||[],0===(F=F||[]).length&&(x=0),-1!=x&&(F.splice(x,0,a.weight),B.splice(x,0,a.distance)),e.data(o,F),e.data(s,B),e.addClass(this.syntax[n].class),(F.length>1||B.length>1)&&e.addClass(this.syntax[n].multiClass),x},removeAnchor:function(e,t){void 0!==e&&void 0!==t||(e=this.currentCtxEdge,t=this.currentAnchorIndex);var n=this.getEdgeType(e);if(!this.edgeTypeInconclusiveShouldntHappen(n,"anchorPointUtilities.js, removeAnchor")){var i=this.syntax[n].weight,o=this.syntax[n].distance,s=this.syntax[n].pointPos,a=e.data(i),d=e.data(o),r=e.data(s);a.splice(t,1),d.splice(t,1),r&&r.splice(t,1),1==a.length||1==d.length?e.removeClass(this.syntax[n].multiClass):0==a.length||0==d.length?(e.removeClass(this.syntax[n].class),e.data(i,[]),e.data(o,[])):(e.data(i,a),e.data(o,d))}},removeAllAnchors:function(e){void 0===e&&(e=this.currentCtxEdge);var t=this.getEdgeType(e);if(!this.edgeTypeInconclusiveShouldntHappen(t,"anchorPointUtilities.js, removeAllAnchors")){e.removeClass(this.syntax[t].class),e.removeClass(this.syntax[t].multiClass);var n=this.syntax[t].weight,i=this.syntax[t].distance,o=this.syntax[t].pointPos;e.data(n,[]),e.data(i,[]),e.data(o)&&e.data(o,[])}},calculateDistance:function(e,t){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(Math.pow(n,2)+Math.pow(i,2))},compareWithPrecision:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01,o=e-t;return Math.abs(o)<=i||(n?e<t:e>t)},edgeTypeInconclusiveShouldntHappen:function(e,t){return"inconclusive"===e&&(console.log("In "+t+": edge type inconclusive should never happen here!!"),!0)}};e.exports=i},function(e,t,n){"use strict";var i,o,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=(i=Math.max,o=Date.now||function(){return(new Date).getTime()},function(e,t,n){var a,d,r,c,l,g,u,h,y,v=0,f=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");if(t=t<0?0:+t||0,!0===n){var x=!0;p=!1}else y=void 0===(h=n)?"undefined":s(h),!h||"object"!=y&&"function"!=y||(x=!!n.leading,f="maxWait"in n&&i(+n.maxWait||0,t),p="trailing"in n?!!n.trailing:p);function m(t,n){n&&clearTimeout(n),d=g=u=void 0,t&&(v=o(),r=e.apply(l,a),g||d||(a=l=void 0))}function b(){var e=t-(o()-c);e<=0||e>t?m(u,d):g=setTimeout(b,e)}function A(){m(p,g)}function w(){if(a=arguments,c=o(),l=this,u=p&&(g||!x),!1===f)var n=x&&!g;else{d||x||(v=c);var i=f-(c-v),s=i<=0||i>f;s?(d&&(d=clearTimeout(d)),v=c,r=e.apply(l,a)):d||(d=setTimeout(A,i))}return s&&g?g=clearTimeout(g):g||t===f||(g=setTimeout(b,t)),n&&(s=!0,r=e.apply(l,a)),!s||g||d||(a=l=void 0),r}return w.cancel=function(){g&&clearTimeout(g),d&&clearTimeout(d),v=0,d=g=u=void 0},w});e.exports=a},function(e,t,n){"use strict";var i,o,s;o=n(0),n(1),s=function(e,t,i){var s=n(3);if(e&&t&&i){var a,d={bendPositionsFunction:function(e){return e.data("bendPointPositions")},controlPositionsFunction:function(e){return e.data("controlPointPositions")},initAnchorsAutomatically:!0,ignoredClasses:[],undoable:!1,anchorShapeSizeFactor:3,zIndex:999,enabled:!0,bendRemovalSensitivity:8,addBendMenuItemTitle:"Add Bend Point",removeBendMenuItemTitle:"Remove Bend Point",removeAllBendMenuItemTitle:"Remove All Bend Points",addControlMenuItemTitle:"Add Control Point",removeControlMenuItemTitle:"Remove Control Point",removeAllControlMenuItemTitle:"Remove All Control Points",moveSelectedAnchorsOnKeyEvents:function(){return!0},enableMultipleAnchorRemovalOption:!1,useTrailingDividersAfterContextMenuOptions:!1},r=!1;e("core","edgeEditing",(function(e){var t=this;return"initialized"===e?r:("get"!==e&&(a=function(e,t){var n={};for(var i in e)n[i]=e[i];for(var i in t)if("bendRemovalSensitivity"==i){var o=t[i];isNaN(o)||(n[i]=o>=0&&o<=20?t[i]:o<0?0:20)}else n[i]=t[i];return n}(d,e),r=!0,t.style().selector(".edgebendediting-hasbendpoints").css({"curve-style":"segments","segment-distances":function(e){return o.getDistancesString(e,"bend")},"segment-weights":function(e){return o.getWeightsString(e,"bend")},"edge-distances":"node-position"}),t.style().selector(".edgecontrolediting-hascontrolpoints").css({"curve-style":"unbundled-bezier","control-point-distances":function(e){return o.getDistancesString(e,"control")},"control-point-weights":function(e){return o.getWeightsString(e,"control")},"edge-distances":"node-position"}),o.setIgnoredClasses(a.ignoredClasses),a.initAnchorsAutomatically&&o.initAnchorPoints(a.bendPositionsFunction,a.controlPositionsFunction,t.edges(),a.ignoredClasses),a.enabled?s(a,t):s("unbind",t)),r?{getAnchorsAsArray:function(e){return o.getAnchorsAsArray(e)},initAnchorPoints:function(e){o.initAnchorPoints(a.bendPositionsFunction,a.controlPositionsFunction,e)},deleteSelectedAnchor:function(e,t){o.removeAnchor(e,t)}}:void 0)}))}},e.exports&&(e.exports=s),void 0===(i=function(){return s}.call(t,n,t,e))||(e.exports=i),"undefined"!=typeof cytoscape&&$&&Konva&&s(cytoscape,$,Konva)},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(1),s=n(0),a=n(4),d=n(5),r=0;e.exports=function(e,t){var n,c,l,g,u,h,y,v,f,p,x,m,b,A,w,C,P,T,E=e,M="cy-edge-bend-editing-cxt-add-bend-point"+r,I="cy-edge-bend-editing-cxt-remove-bend-point"+r,S="cy-edge-bend-editing-cxt-remove-multiple-bend-point"+r,D="cy-edge-control-editing-cxt-add-control-point"+r,R="cy-edge-control-editing-cxt-remove-control-point"+r,O="cy-edge-bend-editing-cxt-remove-multiple-control-point"+r,F=null,B=null,K=!1,W={init:function(){d(t,s,e);var i=e,E=$(this),W="cy-node-edge-editing-stage"+r;r++;var k,z,j=$('<div id="'+W+'"></div>');E.find("#"+W).length<1&&E.append(j),(k=Konva.stages.length<r?new Konva.Stage({id:"node-edge-editing-stage",container:W,width:E.width(),height:E.height()}):Konva.stages[r-1]).getChildren().length<1?(z=new Konva.Layer,k.add(z)):z=k.getChildren()[0];var L={edge:void 0,edgeType:"inconclusive",anchors:[],touchedAnchor:void 0,touchedAnchorIndex:void 0,bindListeners:function(e){e.on("mousedown touchstart",this.eMouseDown)},unbindListeners:function(e){e.off("mousedown touchstart",this.eMouseDown)},eMouseDown:function(e){t.autounselectify(!1),K=!0,L.touchedAnchor=e.target,T=!1,L.edge.unselect();var n=s.syntax[L.edgeType].weight,i=s.syntax[L.edgeType].distance,o=L.edge;ue={edge:o,type:L.edgeType,weights:o.data(n)?[].concat(o.data(n)):[],distances:o.data(i)?[].concat(o.data(i)):[]},function(){C=t.style()._private.coreStyle["active-bg-opacity"]?t.style()._private.coreStyle["active-bg-opacity"].value:.15;t.style().selector("core").style("active-bg-opacity",0).update()}(),ae(),t.autoungrabify(!0),z.getStage().on("contentTouchend contentMouseup",L.eMouseUp),z.getStage().on("contentMouseout",L.eMouseOut)},eMouseUp:function(e){K=!1,L.touchedAnchor=void 0,T=!1,L.edge.select(),t.style().selector("core").style("active-bg-opacity",C).update(),de(),t.autounselectify(!0),t.autoungrabify(!1),z.getStage().off("contentTouchend contentMouseup",L.eMouseUp),z.getStage().off("contentMouseout",L.eMouseOut)},eMouseOut:function(e){T=!0},clearAnchorsExcept:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=!1;this.anchors.forEach((function(i,o){t&&i===t?n=!0:(e.unbindListeners(i),i.destroy())})),n?this.anchors=[t]:(this.anchors=[],this.edge=void 0,this.edgeType="inconclusive")},renderAnchorShapes:function(e){if(this.edge=e,this.edgeType=s.getEdgeType(e),e.hasClass("edgebendediting-hasbendpoints")||e.hasClass("edgecontrolediting-hascontrolpoints")){for(var t=s.getAnchorsAsArray(e),n=.65*ie(e),i=(e.source().position(),e.target().position(),0);t&&i<t.length;i+=2){var o=t[i],a=t[i+1];this.renderAnchorShape(o,a,n)}z.draw()}},renderAnchorShape:function(e,n,i){var o=te({x:e-i/2,y:n-i/2});i*=t.zoom();var s=new Konva.Rect({x:o.x,y:o.y,width:i,height:i,fill:"black",strokeWidth:0,draggable:!0});this.anchors.push(s),this.bindListeners(s),z.add(s)}},U=function(e,n){var i=e.target||e.cyTarget;if(!s.isIgnoredEdge(i)){var o,a,d,r,c=s.getEdgeType(i);"inconclusive"===c?(o=[],a=[]):(d=s.syntax[c].weight,r=s.syntax[c].distance,o=i.data(d)?[].concat(i.data(d)):i.data(d),a=i.data(r)?[].concat(i.data(r)):i.data(r));var l={edge:i,type:c,weights:o,distances:a};s.addAnchorPoint(void 0,void 0,n),ee().undoable&&t.undoRedo().do("changeAnchorPoints",l)}ne(),i.select()},_=function(e){var n=L.edge,i=s.getEdgeType(n);if(!s.edgeTypeInconclusiveShouldntHappen(i,"UiUtilities.js, cxtRemoveAnchorFcn")){var o={edge:n,type:i,weights:[].concat(n.data(s.syntax[i].weight)),distances:[].concat(n.data(s.syntax[i].distance))};s.removeAnchor(),ee().undoable&&t.undoRedo().do("changeAnchorPoints",o),setTimeout((function(){ne(),n.select()}),50)}},N=function(e){var n=L.edge,i=s.getEdgeType(n),o={edge:n,type:i,weights:[].concat(n.data(s.syntax[i].weight)),distances:[].concat(n.data(s.syntax[i].distance))};s.removeAllAnchors(),ee().undoable&&t.undoRedo().do("changeAnchorPoints",o),setTimeout((function(){ne(),n.select()}),50)},q=i.handleReconnectEdge,H=i.validateEdge,V=i.actOnUnsuccessfulReconnection,X=[{id:M,content:i.addBendMenuItemTitle,selector:"edge",onClickFunction:function(e){U(e,"bend")},hasTrailingDivider:i.useTrailingDividersAfterContextMenuOptions},{id:I,content:i.removeBendMenuItemTitle,selector:"edge",onClickFunction:_,hasTrailingDivider:i.useTrailingDividersAfterContextMenuOptions},{id:S,content:i.removeAllBendMenuItemTitle,selector:i.enableMultipleAnchorRemovalOption&&":selected.edgebendediting-hasmultiplebendpoints",onClickFunction:N,hasTrailingDivider:i.useTrailingDividersAfterContextMenuOptions},{id:D,content:i.addControlMenuItemTitle,selector:"edge",coreAsWell:!0,onClickFunction:function(e){U(e,"control")},hasTrailingDivider:i.useTrailingDividersAfterContextMenuOptions},{id:R,content:i.removeControlMenuItemTitle,selector:"edge",coreAsWell:!0,onClickFunction:_,hasTrailingDivider:i.useTrailingDividersAfterContextMenuOptions},{id:O,content:i.removeAllControlMenuItemTitle,selector:i.enableMultipleAnchorRemovalOption&&":selected.edgecontrolediting-hasmultiplecontrolpoints",onClickFunction:N,hasTrailingDivider:i.useTrailingDividersAfterContextMenuOptions}];if(t.contextMenus){var G=t.contextMenus("get");G.isActive()?G.appendMenuItems(X):t.contextMenus({menuItems:X})}var J=o((function(){j.attr("height",E.height()).attr("width",E.width()).css({position:"absolute",top:0,left:0,"z-index":ee().zIndex}),setTimeout((function(){var e=j.offset(),n=E.offset();j.css({top:-(e.top-n.top),left:-(e.left-n.left)}),z.getStage().setWidth(E.width()),z.getStage().setHeight(E.height()),t&&ne()}),0)}),250);function Q(){J()}Q(),$(window).bind("resize",(function(){Q()}));var Y,Z=E.data("cyedgeediting");function ee(){return Y||(Y=E.data("cyedgeediting").options)}function te(e){var n=t.pan(),i=t.zoom();return{x:e.x*i+n.x,y:e.y*i+n.y}}function ne(){L.clearAnchorsExcept(L.touchedAnchor),null!==F&&(F.destroy(),F=null),null!==B&&(B.destroy(),B=null),z.draw(),P&&(L.renderAnchorShapes(P),function(e){if(!e)return;var n=s.getAnchorsAsArray(e);void 0===n&&(n=[]);var i=e.sourceEndpoint(),o=e.targetEndpoint();if(!i.x||!o.x)return;if(n.unshift(i.y),n.unshift(i.x),n.push(o.x),n.push(o.y),!n)return;var a={x:n[0],y:n[1]},d={x:n[n.length-2],y:n[n.length-1]},r={x:n[2],y:n[3]},c={x:n[n.length-4],y:n[n.length-3]},l=.65*ie(e);!function(e,n,i,o,s){var a=e.x-i/2,d=e.y-i/2,r=n.x-i/2,c=n.y-i/2,l=o.x-i/2,g=o.y-i/2,u=s.x-i/2,h=s.y-i/2,y=te({x:a,y:d}),v=te({x:r,y:c});i=i*t.zoom()/2;var f=te({x:l,y:g}),p=te({x:u,y:h}),x=i,m=Math.sqrt(Math.pow(f.x-y.x,2)+Math.pow(f.y-y.y,2)),b=y.x+x/m*(f.x-y.x),A=y.y+x/m*(f.y-y.y),w=Math.sqrt(Math.pow(p.x-v.x,2)+Math.pow(p.y-v.y,2)),C=v.x+x/w*(p.x-v.x),P=v.y+x/w*(p.y-v.y);null===F&&(F=new Konva.Circle({x:b+i,y:A+i,radius:i,fill:"black"}));null===B&&(B=new Konva.Circle({x:C+i,y:P+i,radius:i,fill:"black"}));z.add(F),z.add(B),z.draw()}(a,d,l,r,c)}(P))}function ie(e){var t=ee().anchorShapeSizeFactor;return parseFloat(e.css("width"))<=2.5?2.5*t:parseFloat(e.css("width"))*t}function oe(e,t,n,i,o){return e>=i-n/2&&e<=i+n/2&&t>=o-n/2&&t<=o+n/2}function se(e,t,n){var i=s.getEdgeType(n);if("inconclusive"===i)return-1;if(null==n.data(s.syntax[i].weight)||0==n.data(s.syntax[i].weight).length)return-1;for(var o=s.getAnchorsAsArray(n),a=ie(n),d=0;o&&d<o.length;d+=2){if(oe(e,t,a,o[d],o[d+1]))return d/2}return-1}function ae(){b=t.panningEnabled(),A=t.zoomingEnabled(),w=t.boxSelectionEnabled(),t.zoomingEnabled(!1).panningEnabled(!1).boxSelectionEnabled(!1)}function de(){t.zoomingEnabled(A).panningEnabled(b).boxSelectionEnabled(w)}null==Z&&(Z={}),Z.options=i;var re=o((function(e,t,n,i){var o=e.data(s.syntax[t].weight),a=e.data(s.syntax[t].distance),d=s.convertToRelativePosition(e,i);o[n]=d.weight,a[n]=d.distance,e.data(s.syntax[t].weight,o),e.data(s.syntax[t].distance,a)}),5);b=t.panningEnabled(),A=t.zoomingEnabled(),w=t.boxSelectionEnabled();var ce,le,ge,ue,he,ye,ve,fe,pe,xe=(Ce=t.edges(":selected")).length;1===xe&&(P=Ce[0]),t.bind("zoom pan",g=function(){P&&ne()}),t.on("data","edge",(function(){P&&ne()})),t.on("style","edge.edgebendediting-hasbendpoints:selected, edge.edgecontrolediting-hascontrolpoints:selected",n=function(){setTimeout((function(){ne()}),50)}),t.on("remove","edge",c=function(){if(this.selected()){if(xe-=1,t.startBatch(),P&&P.removeClass("cy-edge-editing-highlight"),1===xe){var e=t.edges(":selected");1===e.length?(P=e[0]).addClass("cy-edge-editing-highlight"):P=void 0}else P=void 0;t.endBatch()}ne()}),t.on("add","edge",l=function(){this.selected()&&(xe+=1,t.startBatch(),P&&P.removeClass("cy-edge-editing-highlight"),1===xe?(P=this).addClass("cy-edge-editing-highlight"):P=void 0,t.endBatch()),ne()}),t.on("select","edge",u=function(){0!=this.target().connectedEdges().length&&0!=this.source().connectedEdges().length&&(xe+=1,t.startBatch(),P&&P.removeClass("cy-edge-editing-highlight"),1===xe?(P=this).addClass("cy-edge-editing-highlight"):P=void 0,t.endBatch(),ne())}),t.on("unselect","edge",h=function(){if(xe-=1,t.startBatch(),P&&P.removeClass("cy-edge-editing-highlight"),1===xe){var e=t.edges(":selected");1===e.length?(P=e[0]).addClass("cy-edge-editing-highlight"):P=void 0}else P=void 0;t.endBatch(),ne()});var me,be,Ae,we,Ce,Pe=!1;t.on("tapstart",y=function(e){le=e.position||e.cyPosition}),t.on("tapstart","edge",v=function(e){if(P&&P.id()===this.id()){ge=this;var n=s.getEdgeType(this);"inconclusive"===n&&(n="bend");var i=function(e,t,n){var i=ie(n),o=n._private.rscratch.allpts,s={x:o[0],y:o[1]},a={x:o[o.length-2],y:o[o.length-1]};return te(s),te(a),oe(e,t,i,s.x,s.y)?0:oe(e,t,i,a.x,a.y)?1:-1}(le.x,le.y,this);if(0==i||1==i){this.unselect(),ye=i,fe=0==i?ge.source():ge.target();var o=0==i?"source":"target",d=a.disconnectEdge(ge,t,e.renderedPosition,o);ve=d.dummyNode,ge=d.edge,ae()}else ce=void 0,he=!0}else he=!1}),t.on("drag","node",m=function(){P&&ne()}),t.on("tapdrag",f=function(e){t.edges(":selected").length>0&&t.autounselectify(!1);var n=ge;if(void 0===ge||!s.isIgnoredEdge(n)){var i=s.getEdgeType(n);if(he&&!K&&"inconclusive"!==i){var o=s.syntax[i].weight,a=s.syntax[i].distance;ue={edge:n,type:i,weights:n.data(o)?[].concat(n.data(o)):[],distances:n.data(a)?[].concat(n.data(a)):[]},n.unselect(),ce=s.addAnchorPoint(n,le),ge=n,he=void 0,Pe=!0,ae()}if(K||void 0!==ge&&(void 0!==ce||void 0!==ye)){var d=e.position||e.cyPosition;-1!=ye&&ve?ve.position(d):null!=ce?re(n,i,ce,d):K&&(void 0===L.touchedAnchorIndex&&le&&(L.touchedAnchorIndex=se(le.x,le.y,L.edge)),void 0!==L.touchedAnchorIndex&&re(L.edge,L.edgeType,L.touchedAnchorIndex,d)),e.target&&e.target[0]&&e.target.isNode()&&(pe=e.target)}}}),t.on("tapend",p=function(e){T&&z.getStage().fire("contentMouseup");var n=ge||L.edge;if(void 0!==n){var i=L.touchedAnchorIndex;if(null!=i){var o,d=n.source().position("x"),r=n.source().position("y"),c=n.target().position("x"),l=n.target().position("y"),g=s.getAnchorsAsArray(n),u=[d,r].concat(g).concat([c,l]),h=i+1,y=h-1,v=h+1,f={x:u[2*h],y:u[2*h+1]},p={x:u[2*y],y:u[2*y+1]},x={x:u[2*v],y:u[2*v+1]};if(f.x===p.x&&f.y===p.y||f.x===p.x&&f.y===p.y)o=!0;else{var m,b=(p.y-x.y)/(p.x-x.x),A={srcPoint:p,tgtPoint:x,m1:b,m2:-1/b},w=s.getIntersection(n,f,A),C=Math.sqrt(Math.pow(f.x-w.x,2)+Math.pow(f.y-w.y,2));"bend"===(m=s.getEdgeType(n))&&C<ee().bendRemovalSensitivity&&(o=!0)}o&&s.removeAnchor(n,i)}else if(null!=ve&&(0==ye||1==ye)){var P=fe,E="valid",M=0==ye?"source":"target";if(pe){var I=0==ye?pe:n.source(),S=1==ye?pe:n.target();"function"==typeof H&&(E=H(n,I,S)),P="valid"===E?pe:fe}I=0==ye?P:n.source(),S=1==ye?P:n.target();if(n=a.connectEdge(n,fe,M),fe.id()!==P.id())if("function"==typeof q){var D=q(I.id(),S.id(),n.data());if(D&&(a.copyEdge(n,D),s.initAnchorPoints(ee().bendPositionsFunction,ee().controlPositionsFunction,[D])),D&&ee().undoable){var R={newEdge:D,oldEdge:n};t.undoRedo().do("removeReconnectedEdge",R),n=D}else D&&(t.remove(n),n=D)}else{var O=0==ye?{source:P.id()}:{target:P.id()},F=0==ye?{source:fe.id()}:{target:fe.id()};if(ee().undoable&&P.id()!==fe.id()){var B={edge:n,location:O,oldLoc:F};n=t.undoRedo().do("reconnectEdge",B).edge}}"valid"!==E&&"function"==typeof V&&V(),n.select(),t.remove(ve)}}"inconclusive"===(m=s.getEdgeType(n))&&(m="bend"),void 0!==L.touchedAnchorIndex||Pe||(ue=void 0);var K=s.syntax[m].weight;void 0!==n&&void 0!==ue&&(n.data(K)?n.data(K).toString():null)!=ue.weights.toString()&&(Pe&&(n.select(),t.autounselectify(!0)),ee().undoable&&t.undoRedo().do("changeAnchorPoints",ue)),ce=void 0,ge=void 0,ue=void 0,he=void 0,ye=void 0,ve=void 0,fe=void 0,pe=void 0,le=void 0,Pe=!1,L.touchedAnchorIndex=void 0,de(),setTimeout((function(){ne()}),50)}),t.on("edgeediting.movestart",(function(e,t){we=!1,null!=t[0]&&t.forEach((function(e){null==s.getAnchorsAsArray(e)||we||(be={x:s.getAnchorsAsArray(e)[0],y:s.getAnchorsAsArray(e)[1]},me={firstTime:!0,firstAnchorPosition:{x:be.x,y:be.y},edges:t},Ae=e,we=!0)}))})),t.on("edgeediting.moveend",(function(e,n){if(null!=me){var i=me.firstAnchorPosition,o={x:s.getAnchorsAsArray(Ae)[0],y:s.getAnchorsAsArray(Ae)[1]};me.positionDiff={x:-o.x+i.x,y:-o.y+i.y},delete me.firstAnchorPosition,ee().undoable&&t.undoRedo().do("moveAnchorPoints",me),me=void 0}})),t.on("cxttap",x=function(e){var n,o,a=e.target||e.cyTarget,d=!1;try{d=a.isEdge()}catch(e){}d?(n=a,o=s.getEdgeType(n)):(n=L.edge,o=L.edgeType);var r=t.contextMenus("get");if(!P||P.id()!=n.id()||s.isIgnoredEdge(n)||P!==n)return r.hideMenuItem(I),r.hideMenuItem(M),r.hideMenuItem(R),void r.hideMenuItem(D);var c=e.position||e.cyPosition,l=se(c.x,c.y,n);-1==l?(r.hideMenuItem(I),r.hideMenuItem(R),"control"===o&&d?(r.showMenuItem(D),r.hideMenuItem(M)):"bend"===o&&d?(r.showMenuItem(M),r.hideMenuItem(D)):d?(r.showMenuItem(M),r.showMenuItem(D)):(r.hideMenuItem(M),r.hideMenuItem(D)),s.currentCtxPos=c):(r.hideMenuItem(M),r.hideMenuItem(D),"control"===o?(r.showMenuItem(R),r.hideMenuItem(I),i.enableMultipleAnchorRemovalOption&&n.hasClass("edgecontrolediting-hasmultiplecontrolpoints")&&r.showMenuItem(O)):"bend"===o?(r.showMenuItem(I),r.hideMenuItem(R)):(r.hideMenuItem(I),r.hideMenuItem(R),r.hideMenuItem(O)),s.currentAnchorIndex=l),s.currentCtxEdge=n}),t.on("cyedgeediting.changeAnchorPoints","edge",(function(){t.startBatch(),t.edges().unselect(),t.trigger("bendPointMovement"),t.endBatch(),ne()}));var Te=!1,Ee={37:!1,38:!1,39:!1,40:!1};document.addEventListener("keydown",(function(e){if("function"==typeof ee().moveSelectedAnchorsOnKeyEvents?ee().moveSelectedAnchorsOnKeyEvents():ee().moveSelectedAnchorsOnKeyEvents){var n,i,o=document.activeElement.tagName;if("TEXTAREA"!=o&&"INPUT"!=o){switch(e.keyCode){case 37:case 39:case 38:case 40:case 32:e.preventDefault()}if(e.keyCode<"37"||e.keyCode>"40")return;if(Ee[e.keyCode]=!0,t.edges(":selected").length!=t.elements(":selected").length||1!=t.edges(":selected").length)return;Te||(Ce=t.edges(":selected"),t.trigger("edgeediting.movestart",[Ce]),Te=!0);var a=3;if(e.altKey&&e.shiftKey)return;e.altKey?a=1:e.shiftKey&&(a=10);var d=0,r=0;d+=Ee[39]?a:0,d-=Ee[37]?a:0,r+=Ee[40]?a:0,r-=Ee[38]?a:0,n={x:d,y:r},(i=Ce).forEach((function(e){var t=s.getAnchorsAsArray(e),i=[];if(null!=t){for(var o=0;o<t.length;o+=2)i.push({x:t[o]+n.x,y:t[o+1]+n.y});var a=s.getEdgeType(e);if(s.edgeTypeInconclusiveShouldntHappen(a,"UiUtilities.js, moveAnchorPoints"))return;e.data(s.syntax[a].pointPos,i)}})),s.initAnchorPoints(ee().bendPositionsFunction,ee().controlPositionsFunction,i),t.trigger("bendPointMovement")}}}),!0),document.addEventListener("keyup",(function(e){e.keyCode<"37"||e.keyCode>"40"||(e.preventDefault(),Ee[e.keyCode]=!1,("function"==typeof ee().moveSelectedAnchorsOnKeyEvents?ee().moveSelectedAnchorsOnKeyEvents():ee().moveSelectedAnchorsOnKeyEvents)&&(t.trigger("edgeediting.moveend",[Ce]),Ce=void 0,Te=!1))}),!0),E.data("cyedgeediting",Z)},unbind:function(){t.off("remove","node",c).off("add","node",l).off("style","edge.edgebendediting-hasbendpoints:selected, edge.edgecontrolediting-hascontrolpoints:selected",n).off("select","edge",u).off("unselect","edge",h).off("tapstart",y).off("tapstart","edge",v).off("tapdrag",f).off("tapend",p).off("cxttap",x).off("drag","node",m),t.unbind("zoom pan",g)}};return W[E]?W[E].apply($(t.container()),Array.prototype.slice.call(arguments,1)):"object"!=(void 0===E?"undefined":i(E))&&E?($.error("No such function `"+E+"` for cytoscape.js-edge-editing"),$(this)):W.init.apply($(t.container()),arguments)}},function(e,t,n){"use strict";e.exports={disconnectEdge:function(e,t,n,i){var o={data:{id:"nwt_reconnectEdge_dummy",ports:[]},style:{width:1,height:1,visibility:"hidden"},renderedPosition:n};t.add(o);var s="source"===i?{source:o.data.id}:{target:o.data.id};return e=e.move(s)[0],{dummyNode:t.nodes("#"+o.data.id)[0],edge:e}},connectEdge:function(e,t,n){if(e.isEdge()&&t.isNode()){var i={};if("source"===n)i.source=t.id();else{if("target"!==n)return;i.target=t.id()}return e.move(i)[0]}},copyEdge:function(e,t){this.copyAnchors(e,t),this.copyStyle(e,t)},copyStyle:function(e,t){e&&t&&(t.data("line-color",e.data("line-color")),t.data("width",e.data("width")),t.data("cardinality",e.data("cardinality")))},copyAnchors:function(e,t){if(e.hasClass("edgebendediting-hasbendpoints")){var n=e.data("cyedgebendeditingDistances"),i=e.data("cyedgebendeditingWeights");t.data("cyedgebendeditingDistances",n),t.data("cyedgebendeditingWeights",i),t.addClass("edgebendediting-hasbendpoints")}else if(e.hasClass("edgecontrolediting-hascontrolpoints")){n=e.data("cyedgecontroleditingDistances"),i=e.data("cyedgecontroleditingWeights");t.data("cyedgecontroleditingDistances",n),t.data("cyedgecontroleditingWeights",i),t.addClass("edgecontrolediting-hascontrolpoints")}e.hasClass("edgebendediting-hasmultiplebendpoints")?t.addClass("edgebendediting-hasmultiplebendpoints"):e.hasClass("edgecontrolediting-hasmultiplecontrolpoints")&&t.addClass("edgecontrolediting-hasmultiplecontrolpoints")}}},function(e,t,n){"use strict";e.exports=function(e,t,n){if(null!=e.undoRedo){var i=e.undoRedo({defaultActions:!1,isDebug:!0});i.action("changeAnchorPoints",o,o),i.action("moveAnchorPoints",s,s),i.action("reconnectEdge",a,a),i.action("removeReconnectedEdge",d,d)}function o(n){var i,o,s,a,d=e.getElementById(n.edge.id()),r="inconclusive"!==n.type?n.type:t.getEdgeType(d);"inconclusive"!==n.type||n.set?(s=t.syntax[r].weight,a=t.syntax[r].distance,i=n.set?d.data(s):n.weights,o=n.set?d.data(a):n.distances):(i=[],o=[]);var c={edge:d,type:r,weights:i,distances:o,set:!0};if(n.set){var l=n.weights&&n.weights.length>0,g=l&&n.weights.length>1;l?d.data(s,n.weights):d.removeData(s),l?d.data(a,n.distances):d.removeData(a);var u=t.syntax[r].class,h=t.syntax[r].multiClass;l||g?l&&!g?(d.addClass(u),d.removeClass(h)):d.addClass(u+" "+h):d.removeClass(u+" "+h),d.selected()?(d.unselect(),d.select()):d.select()}return d.trigger("cyedgeediting.changeAnchorPoints"),c}function s(e){if(e.firstTime)return delete e.firstTime,e;var i=e.edges,o=e.positionDiff,s={edges:i,positionDiff:{x:-o.x,y:-o.y}};return function(e,i){i.forEach((function(n){var i=t.getEdgeType(n),o=t.getAnchorsAsArray(n),s=[];if(null!=o){for(var a=0;a<o.length;a+=2)s.push({x:o[a]+e.x,y:o[a+1]+e.y});n.data(t.syntax[i].pointPos,s)}})),t.initAnchorPoints(n.bendPositionsFunction,n.controlPositionsFunction,i)}(o,i),s}function a(e){var t=e.edge,n=e.location,i=e.oldLoc,o={edge:t=t.move(n)[0],location:i,oldLoc:n};return t.unselect(),o}function d(t){var n=t.oldEdge;(i=e.getElementById(n.data("id")))&&i.length>0&&(n=i);var i,o=t.newEdge;return(i=e.getElementById(o.data("id")))&&i.length>0&&(o=i),n.inside()&&(n=n.remove()[0]),o.removed()&&(o=o.restore()).unselect(),{oldEdge:o,newEdge:n}}}}])}));